#!/bin/sh

set -e

test -z "$3" || echo usage: prompt [icon-id] text
test -z "$3"

iconid=128
text="$1"
test -z "$2" || iconid="$1"
test -z "$2" || text="$2"

cd /gui/new/port

echo 5 > procid

echo 300,125 > size

ln /gui/new/stack view

icon=view/icon/v
main=view/main/v
entry=view/entry/v
ok=view/ok/v
cancel=view/cancel/v
defaultkeys=view/defaultkeys/v

ln /gui/new/frame $icon

echo 32 > $icon/width
echo 32 > $icon/height
echo 13 > $icon/.margin-top
echo 23 > $icon/.margin-left
echo 23 > $icon/.margin-right

ln /gui/new/icon $icon/v

ln /gui/new/frame $main

echo 13 > $main/.margin-top
echo 13 > $main/.margin-right
echo 71 > $main/.margin-bottom
echo 78 > $main/.margin-left

ln /gui/new/caption $main/v

ln /gui/new/frame $entry

echo 16 > $entry/height
echo 13 > $entry/.margin-right
echo 49 > $entry/.margin-bottom
echo 78 > $entry/.margin-left
echo 1 > $entry/.outline-width
echo 2 > $entry/padding

ln /gui/new/textedit $entry/v

ln /gui/new/frame $ok

echo 58 > $ok/width
echo 20 > $ok/height
echo 13 > $ok/.margin-right
echo 13 > $ok/.margin-bottom

echo 3 > $ok/.outline-width
echo 1 > $ok/.outline-offset
echo 16 > $ok/.outline-curvature

ln /gui/new/button $ok/v

ln /gui/new/frame $cancel

echo 58 > $cancel/width
echo 20 > $cancel/height
echo 84 > $cancel/.margin-right
echo 13 > $cancel/.margin-bottom

ln /gui/new/button $cancel/v

echo $iconid > $icon/v/data
echo 1 > $icon/v/disabling

echo $text > $main/v/text
echo 1     > $main/v/disabling

echo 1 > $entry/v/singular

echo Cancel > $cancel/v/title

ln -s $ok/v/click accept
ln -s $cancel/v/click cancel

ln /gui/new/defaultkeys $defaultkeys

touch window

echo 0 > window/text-font
#echo ddd > window/back-color

select -1 -r{$ok,$cancel}/v/socket | perl -e '$_ = <STDIN> or exit 2; /cancel/ && exit 1' && cat $entry/v/text && echo

