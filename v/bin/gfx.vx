#!/usr/bin/env vx -Z

# TODO:  Catch, ignore, or block SIGINT and SIGTERM

const BIN = "/opt/metamage/bin/"

if argc > 1 then
{
	const kdmode = *(output-from-run .[ BIN "kdmode" ]).lines()
	
	assert kdmode in [ "text", "graphics" ]
	
	const kdswitch = kdmode != "graphics"
	
	if kdswitch then
	{
		run .[ BIN "kdgraphics" ]
	}
	
	try
	{
		run argv[ 1 -> argc ]
	}
	catch { warn rep _ }
	
	if kdswitch then
	{
		run .[ BIN "kd" kdmode ]
	}
}
